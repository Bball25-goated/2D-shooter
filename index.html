<!DOCTYPE html>
<html>
<head>
  <title>2D Shooter</title>
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
      background: black;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const keys = {};
let mouseX = 0;
let mouseY = 0;

// Game variables
let player = {
  x: canvas.width / 2,
  y: canvas.height / 2,
  speed: 3,
  width: 20,
  height: 20,
  health: 3,
  weapon: 'revolver',
  ammo: 12,
  reloadTime: 1000,
  reloading: false,
  kills: {
    revolver: 0,
    shotgun: 0,
    crossbow: 0,
    grenade: 0,
    sword: 0
  },
  weaponsUnlocked: ['revolver']
};

const bullets = [];
const enemies = [];

// Input
window.addEventListener('keydown', e => keys[e.key] = true);
window.addEventListener('keyup', e => keys[e.key] = false);
canvas.addEventListener('mousemove', e => {
  const rect = canvas.getBoundingClientRect();
  mouseX = e.clientX - rect.left;
  mouseY = e.clientY - rect.top;
});

function shoot() {
  if (player.reloading || player.ammo <= 0) return;
  player.ammo--;

  let angle;
  if (player.weapon === 'crossbow') {
    angle = Math.atan2(mouseY - player.y, mouseX - player.x);
  } else {
    let nearest = getNearestEnemy();
    if (!nearest) return;
    angle = Math.atan2(nearest.y - player.y, nearest.x - player.x);
  }

  bullets.push({
    x: player.x,
    y: player.y,
    angle: angle,
    speed: 7,
    weapon: player.weapon
  });

  if (player.ammo <= 0) {
    player.reloading = true;
    setTimeout(() => {
      player.ammo = 12;
      player.reloading = false;
    }, player.reloadTime);
  }
}

function getNearestEnemy() {
  if (enemies.length === 0) return null;
  return enemies.reduce((a, b) => {
    let da = Math.hypot(a.x - player.x, a.y - player.y);
    let db = Math.hypot(b.x - player.x, b.y - player.y);
    return da < db ? a : b;
  });
}

function spawnEnemy() {
  enemies.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    size: 20,
    health: 1
  });
}

function update() {
  // Movement
  if (keys['w']) player.y -= player.speed;
  if (keys['s']) player.y += player.speed;
  if (keys['a']) player.x -= player.speed;
  if (keys['d']) player.x += player.speed;

  if (keys[' ']) shoot();

  // Switch weapons
  for (let i = 1; i <= 5; i++) {
    if (keys[i.toString()] && player.weaponsUnlocked[i - 1]) {
      player.weapon = player.weaponsUnlocked[i - 1];
    }
  }

  // Update bullets
  for (let i = bullets.length - 1; i >= 0; i--) {
    const b = bullets[i];
    b.x += Math.cos(b.angle) * b.speed;
    b.y += Math.sin(b.angle) * b.speed;

    // Remove off-screen bullets
    if (b.x < 0 || b.y < 0 || b.x > canvas.width || b.y > canvas.height) {
      bullets.splice(i, 1);
    }
  }

  // Collisions
  for (let i = enemies.length - 1; i >= 0; i--) {
    const e = enemies[i];
    for (let j = bullets.length - 1; j >= 0; j--) {
      const b = bullets[j];
      if (Math.hypot(e.x - b.x, e.y - b.y) < e.size) {
        enemies.splice(i, 1);
        bullets.splice(j, 1);
        player.kills[player.weapon]++;
        break;
      }
    }
  }

  // Enemy spawning (basic demo)
  if (Math.random() < 0.02) spawnEnemy();
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Player
  ctx.fillStyle = 'white';
  ctx.fillRect(player.x - player.width / 2, player.y - player.height / 2, player.width, player.height);

  // Bullets
  ctx.fillStyle = 'yellow';
  for (const b of bullets) {
    ctx.beginPath();
    ctx.arc(b.x, b.y, 3, 0, Math.PI * 2);
    ctx.fill();
  }

  // Enemies
  ctx.fillStyle = 'red';
  for (const e of enemies) {
    ctx.beginPath();
    ctx.arc(e.x, e.y, e.size, 0, Math.PI * 2);
    ctx.fill();
  }

  // HUD
  ctx.fillStyle = 'white';
  ctx.fillText(`Health: ${player.health}`, 10, 20);
  ctx.fillText(`Ammo: ${player.ammo}${player.reloading ? ' (reloading)' : ''}`, 10, 40);
  ctx.fillText(`Weapon: ${player.weapon}`, 10, 60);
  ctx.fillText(`Kills (${player.weapon}): ${player.kills[player.weapon]}`, 10, 80);
}

function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
